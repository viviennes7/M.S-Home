<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kms.home.visitor.dao.VisitorDao">

	<resultMap type="VisitorDTO" id="visitor">
		<id column="visitor_sq" property="visitorSq"/> 
		<result column="visitor_subject" property="subject"/>
		<result column="visitor_content" property="content"/>
		<result column="visitor_time" property="time"/>
		<association property="playerDTO" javaType="PlayerDTO">
			<id column="player_sq" property="playSq"/>
			<result column="player_name" property="name"/>
			<result column="player_id" property="id"/>
			<result column="player_password" property="password"/>
			<result column="player_birthdate" property="birthdate"/>
			<result column="player_url" property="url"/>
			<result column="player_introduction" property="introduction"/>
			<result column="player_bg_url" property="bgUrl"/>
		</association>
	</resultMap>

	<!-- 방명록 쓰기 -->
	<insert id="visitorInsert" parameterType="visitorDTO">
		insert into visitor(visitor_sq, player_sq, visitor_subject, visitor_content) values(visitor_sq.nextval,#{playSq},#{subject},#{content})
		
	</insert>
	
	<!-- 방금 쓴 방명록 조회 -->
	<select id="visitorSelectOne" parameterType="hashmap" resultMap="visitor">
		select * from 
		( select row_number() over(order by visitor_sq desc) as rnum,visitor_sq,player.player_sq,visitor_subject, visitor_content, 
		visitor_time,player_name,player_id,player_url,player_bg_url from visitor,player where visitor.player_sq = player.player_sq) 
		WHERE rnum=1
	</select>
	
	
	<!-- 방명록 조회 -->
	<select id="visitorSelect" parameterType="hashmap" resultMap="visitor">
		select * from 
		( select row_number() over(order by visitor_sq desc) as rnum,visitor_sq,player.player_sq,visitor_subject, visitor_content, 
		visitor_time,player_name,player_id,player_url,player_bg_url from visitor,player where visitor.player_sq = player.player_sq) 
		WHERE rnum<![CDATA[ > ]]>= #{start} AND rnum <![CDATA[ < ]]>= #{end}
	</select>
	
	<!-- 방명록 삭제 -->
	<delete id="visitorDel" parameterType="int">
		delete visitor where visitor_sq=${value}
	</delete>

</mapper>



